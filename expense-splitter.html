<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="manifest" href="manifest.json">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50">

<title>Expense Splitter — Modern</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root{
    --bg: #f6f8fb;
    --card: #ffffff;
    --muted: #6b7280;
    --accent: #0ea5e9;
    --accent-700: #0284c7;
    --danger: #ef4444;
    --success: #16a34a;
    --glass: rgba(255,255,255,0.6);
    --shadow: 0 6px 18px rgba(18,38,63,0.06);
    --radius: 12px;
  }
  [data-theme="dark"]{
    --bg: #0b1220;
    --card: #071226;
    --muted: #94a3b8;
    --accent: #38bdf8;
    --accent-700: #0ea5c9;
    --glass: rgba(255,255,255,0.03);
    --shadow: none;
  }

  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:linear-gradient(180deg,var(--bg),#ffffff00);
    padding:20px;
    color:var(--muted);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .app{
    max-width:1100px;
    margin:0 auto;
  }

  header{
    position:sticky; top:12px; z-index:40;
    display:flex; gap:12px; align-items:center; justify-content:space-between;
    background:var(--card); padding:12px 16px; border-radius:14px;
    box-shadow:var(--shadow);
    border:1px solid rgba(15,23,42,0.04);
  }
  .title{display:flex; gap:12px; align-items:center}
  .logo{
    height:44px; width:44px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent-700));
    display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px;
    box-shadow:0 6px 18px rgba(14,165,233,0.14);
  }
  h1{margin:0;font-size:18px;color:var(--muted)}
  p.lead{margin:0;font-size:12px;color:var(--muted)}

  .header-actions{display:flex; gap:8px; align-items:center}
  .btn{background:var(--accent); color:white; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600}
  .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06)}
  .icon{display:inline-flex;align-items:center;gap:8px}

  main{margin-top:18px; display:grid; grid-template-columns: 1fr 420px; gap:18px}
  @media (max-width:980px){ main{grid-template-columns:1fr} }

  /* Left column - main card area */
  .card{background:var(--card); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow); border:1px solid rgba(15,23,42,0.04)}
  .section{margin-bottom:12px}

  /* participants + add form */
  .row{display:flex; gap:8px; align-items:center}
  input[type="text"], input[type="number"], select{
    padding:10px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); font-size:14px; outline:none;
    background:transparent; color:inherit;
  }
  .participants-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{background:linear-gradient(180deg,rgba(255,255,255,0.95),var(--glass)); padding:8px 10px;border-radius:999px;border:1px solid rgba(0,0,0,0.04); display:flex;gap:8px;align-items:center; font-weight:600; color:var(--muted)}
  .chip button{background:transparent;border:none;color:var(--muted);cursor:pointer;font-weight:700}

  /* expense list */
  table{width:100%;border-collapse:collapse;margin-top:8px;font-size:14px}
  th,td{padding:10px;text-align:left;border-bottom:1px dashed rgba(0,0,0,0.04)}
  td.right{text-align:right}
  .muted{color:var(--muted); font-size:13px}

  /* result area */
  .balances{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .balance-pill{padding:10px 12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.9),var(--glass)); min-width:140px; font-weight:600; color:var(--muted)}
  .balance-positive{border-left:4px solid var(--success)}
  .balance-negative{border-left:4px solid var(--danger)}

  /* mobile floating button */
  .fab{position:fixed; right:18px; bottom:18px; width:60px; height:60px; border-radius:999px; display:none; align-items:center; justify-content:center; color:white; background:var(--accent); box-shadow:0 10px 30px rgba(14,165,233,0.18); border:none; font-size:28px}
  @media (max-width:680px){ .fab{display:flex} header{position:static}}

  /* small helpers */
  .muted-help{font-size:13px;color:var(--muted); margin-top:6px}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

  /* modal */
  .modal-backdrop{position:fixed; inset:0;background:rgba(2,6,23,0.6); display:none; align-items:center; justify-content:center; z-index:60}
  .modal{width:520px; max-width:95%; background:var(--card); border-radius:12px;padding:16px; box-shadow:0 14px 40px rgba(2,6,23,0.4)}
  .modal .row{margin-top:8px}

  .tiny{font-size:12px;padding:6px 8px;border-radius:8px}
  .danger{background:var(--danger);color:white}
  .success{background:var(--success);color:white}

  footer{margin-top:16px; text-align:center; color:var(--muted); font-size:13px}
</style>
</head>
<body>
<div class="app" id="app" data-theme="light">
  <header>
    <div class="title">
      <div class="logo">ES</div>
      <div>
        <h1>Expense Splitter</h1>
        <p class="lead">Split bills, settle up, and export a summary — runs right in your browser.</p>
      </div>
    </div>

    <div class="header-actions">
      <div class="controls">
        <select id="currency" title="Currency">
          <option value="$">$ — USD</option>
          <option value="A$">A$ — AUD</option>
          <option value="₹">₹ — INR</option>
          <option value="€">€ — EUR</option>
        </select>
        <button class="btn ghost tiny" id="themeToggle" title="Toggle dark mode">🌙</button>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="exportCSV">Export CSV</button>
        <button class="btn ghost" id="clearAll">Clear Data</button>
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT: Participants + Add Expense + Expenses list + results -->
    <div>
      <div class="card section" aria-labelledby="participantsHeading">
        <h3 id="participantsHeading">Participants</h3>
        <div class="row" style="margin-top:10px">
          <input id="participantInput" type="text" placeholder="Add a person (press Enter)" aria-label="Participant name">
          <button class="btn" id="addParticipantBtn">Add</button>
        </div>
        <div class="participants-list" id="participantsList" aria-live="polite"></div>
      </div>

      <div class="card section" aria-labelledby="addExpenseHeading">
        <h3 id="addExpenseHeading">Add Expense</h3>
        <div class="row" style="margin-top:8px">
          <input id="expenseTitle" type="text" placeholder="Title (e.g., Dinner)" />
          <input id="expenseAmount" type="number" placeholder="Amount" min="0" step="0.01" style="width:160px" />
        </div>
        <div class="row" style="margin-top:8px">
          <select id="expensePayer"></select>
          <div style="flex:1">
            <div class="muted-help">Split between (click to toggle)</div>
            <div id="splitBoxes" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px"></div>
          </div>
        </div>
        <div class="row" style="margin-top:10px; justify-content:flex-end">
          <button class="btn ghost tiny" id="quick25">Split equally</button>
          <button class="btn" id="addExpenseBtn">Add expense</button>
        </div>
      </div>

      <div class="card section" aria-labelledby="expensesHeading">
        <h3 id="expensesHeading">Expenses</h3>
        <div id="expensesContainer" class="muted">No expenses yet</div>
      </div>

      <div class="card section" aria-labelledby="resultsHeading">
        <h3 id="resultsHeading">Balances & Suggested Settlements</h3>
        <div id="balances" class="balances"></div>
        <div id="transactions" style="margin-top:10px"></div>
      </div>
    </div>

    <!-- RIGHT: Chart + summary -->
    <aside>
      <div class="card section">
        <h3>Summary</h3>
        <div class="muted-help">Net balances by person</div>
        <canvas id="balancesChart" height="220" style="margin-top:12px"></canvas>
      </div>

      <div class="card section">
        <h3>Quick Controls</h3>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="btn" id="calcBtn">Recalculate</button>
          <button class="btn ghost" id="compactView">Compact view</button>
          <button class="btn ghost" id="showHelp">How it works</button>
        </div>
      </div>
    </aside>
  </main>

  <button class="fab" id="fab">＋</button>

  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" id="editModal">
      <h3 id="modalTitle">Edit Expense</h3>
      <div class="row">
        <input id="editTitle" type="text" placeholder="Title" style="flex:1"/>
      </div>
      <div class="row">
        <input id="editAmount" type="number" step="0.01" style="width:160px" />
        <select id="editPayer"></select>
      </div>
      <div style="margin-top:8px">
        <div class="muted-help">Select who shares this expense</div>
        <div id="editSplitBoxes" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px"></div>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn ghost" id="cancelEdit">Cancel</button>
        <button class="btn danger" id="deleteExpense">Delete</button>
        <button class="btn" id="saveEdit">Save</button>
      </div>
    </div>
  </div>

  <footer>Made with ❤ — Expense Splitter</footer>
</div>

<script>
/* -------------------------
   Data model & persistence
   ------------------------- */
const STORAGE_KEY = 'es:data:v1';
let state = { participants: [], expenses: [] }; // expense {id,title,amount,payer,split:[]}
const el = id => document.getElementById(id);

function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return;
  try { state = JSON.parse(raw); } catch(e){ console.error('Failed to load state',e) }
}

/* -------------------------
   Utilities
   ------------------------- */
function uid(){ return Math.random().toString(36).slice(2,9); }
function currencyFormat(sym, value){ return `${sym}${Number(value).toFixed(2)}`; }
function showToast(msg, time=1600){
  // small transient message (using alert fallback)
  const d = document.createElement('div');
  d.textContent = msg;
  Object.assign(d.style, {position:'fixed',left:'50%',transform:'translateX(-50%)',bottom:'28px',background:'rgba(0,0,0,0.8)',color:'white',padding:'8px 14px',borderRadius:'8px',zIndex:120});
  document.body.appendChild(d);
  setTimeout(()=>d.remove(), time);
}

/* -------------------------
   DOM rendering
   ------------------------- */

function renderParticipants(){
  const list = el('participantsList');
  list.innerHTML = '';
  state.participants.forEach((p, i)=>{
    const chip = document.createElement('div');
    chip.className='chip';
    chip.innerHTML = `<span>${p}</span>`;
    const rem = document.createElement('button');
    rem.innerHTML = '✕';
    rem.title = 'Remove';
    rem.onclick = ()=>{ if (!confirm(`Remove ${p}? This will also remove them from expense splits.`)) return; removeParticipant(i); }
    chip.appendChild(rem);
    list.appendChild(chip);
  });

  // update payer selects and split boxes
  fillPayerSelects();
  renderSplitBoxes();
}

function renderSplitBoxes(containerId='splitBoxes', prefix=''){
  const container = el(containerId);
  container.innerHTML = '';
  state.participants.forEach(p=>{
    const btn = document.createElement('button');
    btn.className = 'chip';
    btn.style.padding = '6px 10px';
    btn.dataset.name = p;
    btn.textContent = p;
    btn.onclick = ()=> {
      // toggle selected (we'll use aria-pressed)
      const pressed = btn.getAttribute('aria-pressed') === 'true';
      btn.setAttribute('aria-pressed', String(!pressed));
      btn.style.opacity = pressed ? '1' : '0.7';
    };
    // default pressed true
    btn.setAttribute('aria-pressed','true');
    container.appendChild(btn);
  });
}

function fillPayerSelects(){
  const payer = el('expensePayer');
  const editPayer = el('editPayer');
  payer.innerHTML = ''; if (editPayer) editPayer.innerHTML='';
  state.participants.forEach(p=>{
    const o = document.createElement('option'); o.value = p; o.textContent = p;
    payer.appendChild(o);
    if (editPayer){ const o2 = o.cloneNode(true); editPayer.appendChild(o2); }
  });
}

function renderExpenses(){
  const container = el('expensesContainer');
  if (state.expenses.length === 0){ container.innerHTML = '<div class="muted">No expenses yet</div>'; return; }

  let html = `<table aria-live="polite"><thead><tr><th>Title</th><th>Share</th><th>Payer</th><th class="right">Amount</th><th></th></tr></thead><tbody>`;
  state.expenses.forEach((ex)=>{
    html += `<tr>
      <td><strong>${escapeHtml(ex.title)}</strong><div class="muted">${ex.split.join(', ')}</div></td>
      <td>${ex.split.length} pcs</td>
      <td>${escapeHtml(ex.payer)}</td>
      <td class="right">${currencyFormat(el('currency').value, ex.amount)}</td>
      <td class="right"><button class="btn ghost tiny" data-edit="${ex.id}">Edit</button></td>
    </tr>`;
  });
  html += '</tbody></table>';
  container.innerHTML = html;

  // wire edit buttons
  container.querySelectorAll('[data-edit]').forEach(btn=>{
    btn.onclick = ()=> openEditModal(btn.getAttribute('data-edit'));
  });
}

/* -------------------------
   Calculation & settlement
   ------------------------- */
function calculateBalances(){
  // build map
  const balances = {};
  state.participants.forEach(p => balances[p]=0);
  state.expenses.forEach(e=>{
    const share = Number(e.amount) / e.split.length;
    balances[e.payer] += Number(e.amount);
    e.split.forEach(s => balances[s] -= share);
  });
  // round to cents
  Object.keys(balances).forEach(k=> balances[k] = Math.round(balances[k]*100)/100);
  return balances;
}

// Greedy settle to minimal transactions
function settleDebts(balances){
  const list = Object.entries(balances).map(([name,bal])=>({name,bal:Math.round(bal*100)/100}));
  let creditors = list.filter(x=>x.bal>0).sort((a,b)=>b.bal-a.bal);
  let debtors = list.filter(x=>x.bal<0).sort((a,b)=>a.bal-b.bal);
  const tx = [];
  while (creditors.length && debtors.length){
    const c = creditors[0], d = debtors[0];
    const amt = Math.min(c.bal, Math.abs(d.bal));
    if (amt < 0.01) break;
    tx.push({from:d.name, to:c.name, amount: Math.round(amt*100)/100});
    c.bal = Math.round((c.bal - amt)*100)/100;
    d.bal = Math.round((d.bal + amt)*100)/100;
    if (Math.abs(c.bal) < 0.01) creditors.shift();
    if (Math.abs(d.bal) < 0.01) debtors.shift();
    creditors.sort((a,b)=>b.bal-a.bal);
    debtors.sort((a,b)=>a.bal-b.bal);
  }
  return tx;
}

/* -------------------------
   UI update: balances + chart
   ------------------------- */
let chart = null;
function renderBalancesAndSettlements(){
  const balanceMap = calculateBalances();
  const balancesEl = el('balances');
  balancesEl.innerHTML = '';
  Object.entries(balanceMap).forEach(([name,amount])=>{
    const pill = document.createElement('div');
    pill.className = 'balance-pill ' + (amount>=0 ? 'balance-positive' : 'balance-negative');
    pill.innerHTML = `<div style="font-weight:700">${name}</div><div style="margin-top:6px">${currencyFormat(el('currency').value, amount)}</div>`;
    balancesEl.appendChild(pill);
  });

  const tx = settleDebts(balanceMap);
  const txEl = el('transactions');
  if (tx.length === 0) txEl.innerHTML = '<div class="muted">All settled — no transactions suggested.</div>';
  else {
    let html = '<table><tbody>';
    tx.forEach(t => html += `<tr><td>${t.from} → ${t.to}</td><td class="right">${currencyFormat(el('currency').value, t.amount)}</td></tr>`);
    html += '</tbody></table>';
    txEl.innerHTML = html;
  }

  // Chart
  const ctx = el('balancesChart').getContext('2d');
  const labels = Object.keys(balanceMap);
  const data = labels.map(l=>balanceMap[l]);
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type:'bar',
    data:{labels, datasets:[{label:'Net balance', data, borderRadius:6}]},
    options:{
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true}}
    }
  });
}

/* -------------------------
   CRUD operations
   ------------------------- */
function addParticipant(name){
  if (!name) return;
  name = name.trim();
  if (!name) return;
  if (state.participants.includes(name)) { showToast('Already added'); return; }
  state.participants.push(name);
  // if no payer exists for expenses, set default
  saveState(); renderParticipants(); renderExpenses(); renderBalancesAndSettlements();
}

function removeParticipant(index){
  const name = state.participants[index];
  state.participants.splice(index,1);
  // remove them from expense splits and as payer: if they were payer, reassign to first participant or remove expense
  state.expenses = state.expenses.map(e=>{
    e.split = e.split.filter(s=>s!==name);
    if (e.payer === name) e.payer = state.participants[0] || '';
    return e;
  }).filter(e=> e.split.length>0);
  saveState(); renderParticipants(); renderExpenses(); renderBalancesAndSettlements();
}

function addExpense(title, amount, payer, split){
  if (!title || !amount || !payer || !split || split.length===0) { showToast('Fill expense data'); return; }
  state.expenses.push({id: uid(), title: title.trim(), amount: Number(amount), payer, split});
  saveState(); renderExpenses(); renderBalancesAndSettlements();
}

/* -------------------------
   Edit modal
   ------------------------- */
function openEditModal(id){
  const ex = state.expenses.find(e=>e.id===id);
  if (!ex) return;
  const backdrop = el('modalBackdrop');
  backdrop.style.display='flex';
  backdrop.setAttribute('aria-hidden','false');
  el('editTitle').value = ex.title;
  el('editAmount').value = ex.amount;
  el('editSplitBoxes').innerHTML = '';
  // fill payer select via fillPayerSelects already called
  el('editPayer').value = ex.payer;
  // make split boxes
  state.participants.forEach(p=>{
    const btn = document.createElement('button');
    btn.className='chip'; btn.style.padding='6px 10px';
    btn.textContent = p;
    btn.dataset.name = p;
    if (ex.split.includes(p)) { btn.setAttribute('aria-pressed','true'); btn.style.opacity='0.7' }
    else { btn.setAttribute('aria-pressed','false'); btn.style.opacity='1' }
    btn.onclick = ()=> {
      const pressed = btn.getAttribute('aria-pressed') === 'true';
      btn.setAttribute('aria-pressed', String(!pressed));
      btn.style.opacity = pressed ? '1' : '0.7';
    };
    el('editSplitBoxes').appendChild(btn);
  });

  // wire actions
  el('saveEdit').onclick = ()=>{
    const title = el('editTitle').value.trim();
    const amount = Number(el('editAmount').value);
    const payer = el('editPayer').value;
    const split = Array.from(el('editSplitBoxes').children).filter(b=>b.getAttribute('aria-pressed')==='true').map(b=>b.dataset.name);
    if (!title || !amount || !payer || split.length===0) { showToast('Invalid fields'); return; }
    ex.title = title; ex.amount = amount; ex.payer = payer; ex.split = split;
    saveState(); renderExpenses(); renderBalancesAndSettlements(); closeModal();
  };
  el('deleteExpense').onclick = ()=>{
    if (!confirm('Delete this expense?')) return;
    state.expenses = state.expenses.filter(e=>e.id!==id);
    saveState(); renderExpenses(); renderBalancesAndSettlements(); closeModal();
  };
  el('cancelEdit').onclick = closeModal;
}

function closeModal(){
  el('modalBackdrop').style.display='none';
  el('modalBackdrop').setAttribute('aria-hidden','true');
}

/* -------------------------
   Helpers & small features
   ------------------------- */
function escapeHtml(text){ return String(text).replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function exportCSV(){
  if (!state.participants.length) return alert('No data');
  const balances = calculateBalances();
  let csv = 'Name,NetBalance\n';
  Object.entries(balances).forEach(([n,b])=> csv += `${n},${b}\n`);
  csv += '\nTransactions (from,to,amount)\n';
  const tx = settleDebts(balances);
  tx.forEach(t=> csv += `${t.from},${t.to},${t.amount}\n`);
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'expense_summary.csv'; a.click();
}

/* -------------------------
   Wiring UI events
   ------------------------- */
function wire(){
  // initial load
  loadState();
  renderParticipants(); renderExpenses(); renderBalancesAndSettlements();

  // participant add
  el('addParticipantBtn').onclick = ()=> { addParticipant(el('participantInput').value); el('participantInput').value=''; }
  el('participantInput').addEventListener('keydown', (e)=> { if (e.key === 'Enter'){ e.preventDefault(); el('addParticipantBtn').click(); }})

  // expense add
  el('addExpenseBtn').onclick = ()=>{
    const title = el('expenseTitle').value.trim();
    const amount = el('expenseAmount').value;
    const payer = el('expensePayer').value;
    const split = Array.from(el('splitBoxes').children).filter(b=>b.getAttribute('aria-pressed')!=='false').map(b=>b.dataset.name);
    addExpense(title, amount, payer, split);
    el('expenseTitle').value=''; el('expenseAmount').value='';
  }
  el('expenseAmount').addEventListener('keydown', (e)=> { if (e.key==='Enter') el('addExpenseBtn').click(); });

  // Quick split equals (toggle all selected)
  el('quick25').onclick = ()=> {
    Array.from(el('splitBoxes').children).forEach(b=>{ b.setAttribute('aria-pressed','true'); b.style.opacity='0.7'; });
    showToast('Split: everyone selected');
  };

  // currency change updates charts/displays
  el('currency').onchange = ()=> { renderExpenses(); renderBalancesAndSettlements(); };

  // calc button
  el('calcBtn').onclick = ()=> renderBalancesAndSettlements();

  // export / clear
  el('exportCSV').onclick = exportCSV;
  el('clearAll').onclick = ()=> { if (!confirm('Clear all participants & expenses?')) return; state = {participants:[], expenses:[]}; saveState(); renderParticipants(); renderExpenses(); renderBalancesAndSettlements(); showToast('Cleared'); }

  // compact view (toggle row density)
  el('compactView').onclick = ()=>{
    document.querySelectorAll('td,th').forEach(x=> x.style.padding = x.style.padding ? '' : '6px');
  };

  // theme toggle
  el('themeToggle').onclick = ()=>{
    const app = el('app');
    const theme = app.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    app.setAttribute('data-theme', theme);
    el('themeToggle').textContent = theme === 'dark' ? '☀️' : '🌙';
  };

  // fab -> open add expense (scroll into view)
  el('fab').onclick = ()=> { window.scrollTo({top: document.querySelector('main').offsetTop, behavior:'smooth'}); el('expenseTitle').focus(); }

  // show help
  el('showHelp').onclick = ()=> alert('Flow: Add participants → Add expenses (who paid and who shares) → Recalculate → Export CSV. Auto-saves to browser storage.');

  // open edit modal backdrop click to close
  el('modalBackdrop').onclick = (e)=> { if (e.target === el('modalBackdrop')) closeModal(); }

  // when participants change we must rerender selects (for persisted data)
  fillPayerSelects();
}

/* -------------------------
   Init: prepare UI from state
   ------------------------- */
(function init(){
  wire();

  if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js")
    .then(() => console.log("Service Worker Registered"))
    .catch((err) => console.log("SW Registration Failed", err));
}


  // If state has participants loaded, ensure split buttons & payer selects are populated
  if (state.participants.length){
    // ensure expense payer select has options
    fillPayerSelects();
    // ensure split boxes reflect participants (new add)
    renderSplitBoxes();
  } else {
    // demo small placeholder
    // state.participants = ['Alex','Sam','Priya']; // uncomment for demo
  }
})();
</script>
</body>
</html>
